# Logstash配置文件

input {
  # 从文件读取日志
  file {
    path => "E:/ExcelGenius/logs/app.log"
    start_position => "beginning"
    sincedb_path => "NUL"  # Windows系统中重置sincedb，每次都从头开始读取
  }
  
  # 从控制台读取日志（可选）
  stdin {}
}

filter {
  # 解析日志格式：时间戳 - logger名称 - 日志级别 - 消息
  grok {
    match => {
      "message" => [
        "%{TIMESTAMP_ISO8601:timestamp} - %{DATA:logger} - %{LOGLEVEL:loglevel} - %{GREEDYDATA:log_message}"
      ]
    }
  }
  
  # 处理时间戳
  date {
    match => ["timestamp", "yyyy-MM-dd HH:mm:ss,SSS"]
    target => "@timestamp"
  }
  
  # 丰富日志信息
  mutate {
    add_field => {
      "host" => "%{host}"
      "application" => "ExcelGenius"
    }
    remove_field => ["timestamp", "host"]  # 移除不需要的字段
  }
}

output {
  # 输出到Elasticsearch
  elasticsearch {
    hosts => ["http://localhost:9200"]
    index => "excelgenius-%{+YYYY.MM.dd}"
  }
  
  # 输出到控制台（调试用）
  stdout {
    codec => rubydebug
  }
}